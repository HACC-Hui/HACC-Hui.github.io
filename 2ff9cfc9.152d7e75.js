(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{108:function(e,t,o){"use strict";o.r(t),o.d(t,"frontMatter",(function(){return i})),o.d(t,"metadata",(function(){return c})),o.d(t,"rightToc",(function(){return s})),o.d(t,"default",(function(){return p}));var a=o(2),n=o(6),r=(o(0),o(131)),i={title:"Collection Class Hierarchy",sidebar_label:"Collection Class Hierarchy"},c={id:"datamodel/class-hierarchy",title:"Collection Class Hierarchy",description:"Based upon our experience with HACC Hui, we've wrapped every MongoDB collection by a Javascript class with the same name. As we implemented this encapsulation, we observed that there was common functionality that could be abstracted out into a set of two superclasses:",source:"@site/docs/datamodel/class-hierarchy.md",permalink:"/docs/datamodel/class-hierarchy",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/datamodel/class-hierarchy.md",sidebar_label:"Collection Class Hierarchy",sidebar:"someSidebar",previous:{title:"Milestone 4, Due Oct. 22nd.",permalink:"/docs/requirements/milestone4"},next:{title:"Entity-Relationship Model",permalink:"/docs/datamodel/entity-relationship-model"}},s=[],l={rightToc:s};function p(e){var t=e.components,o=Object(n.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},l,o,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Based upon our experience with ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://radgrad.github.io"}),"HACC Hui"),", we've wrapped every MongoDB collection by a Javascript class with the same name. As we implemented this encapsulation, we observed that there was common functionality that could be abstracted out into a set of two superclasses:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("em",{parentName:"li"},"BaseCollection"),".  All classes (with the single exception of the UserCollection class) inherit either directly or indirectly from BaseCollection. This class provides the methods and fields used to manage a MongoDB collection that are common across HACC Hui."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("em",{parentName:"li"},"BaseSlugCollection"),'.  This class extends BaseCollection with methods to support the MongoDB collections whose documents must include a "slug". For more details, see the section on ',Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"entity-relationship-model#slugs"}),"slugs"),".")),Object(r.b)("p",null,"Here is the resulting HACC Hui collection class hierarchy:"),Object(r.b)("img",{src:"/img/datamodel/CollectionClassHierarchy.png",width:"100%"}),Object(r.b)("p",null,'There is one exceptional class: UserCollection, which does not inherit from any of the Base classes.  This is because the UserCollection class encapsulates a "special" MongoDB collection managed by the Meteor.Accounts package. The behavior of this collection is sufficiently different from regular user-defined collections that we did not feel it was appropriate to make it a subclass of any other class. '),Object(r.b)("p",null,"All collections that extend BaseCollection are required to implement three methods:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"define(definitionData)"),": The ",Object(r.b)("inlineCode",{parentName:"p"},"define")," method creates a document in the collection. It returns the ",Object(r.b)("inlineCode",{parentName:"p"},"_id")," of the resulting document. The ",Object(r.b)("inlineCode",{parentName:"p"},"define")," method takes and object as its one parameter. The values in the object that refer to other documents should use ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"entity-relationship-model#slugs"}),"slugs"),". This supports the loading from a database fixture. The ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/HACC-Hui/HACC-Hui/blob/master/app/imports/api/base/BaseCollection.js#L35"}),"BaseCollection.define")," throws an exception.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"update(docID, updateData)"),": The ",Object(r.b)("inlineCode",{parentName:"p"},"update")," method supports changing certain fields of a document. Some fields are immutable by design. The ",Object(r.b)("inlineCode",{parentName:"p"},"update")," method takes two parameters, the docID or slug that identifies which document to update, and an object containing the fields to change. The ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/HACC-Hui/HACC-Hui/blob/master/app/imports/api/base/BaseCollection.js#L45"}),"BaseCollection.update")," method throws an exception.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"dumpOne(docID)"),": The ",Object(r.b)("inlineCode",{parentName:"p"},"dumpOne")," method creates a JSON object representing the document. HACC Hui uses the dump object to restore the document. Restoring an object is calling define using the dump object. This means that the dump object should have slugs not IDs. The ",Object(r.b)("inlineCode",{parentName:"p"},"dumpOne")," method has one parameter the docID to dump.  The ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/HACC-Hui/HACC-Hui/blob/master/app/imports/api/base/BaseCollection.js#L214"}),"BaseCollection.dumpOne")," method throws an exception."))),Object(r.b)("p",null,"Complex collections should also implement two methods:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"removeIt(docID)"),": The ",Object(r.b)("inlineCode",{parentName:"p"},"removeIt")," method removes a single document from the collection. This may have side affects depending on the relationships between collections. The method takes one parameter, the docID or slug, that defines which document to remove. The ",Object(r.b)("inlineCode",{parentName:"p"},"removeIt")," method may throw a Meteor exception if there are other documents refering to it.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},Object(r.b)("strong",{parentName:"p"},"assertValidRoleForMethod(userId)"),": The ",Object(r.b)("inlineCode",{parentName:"p"},"assertValidRoleForMethod")," method checks to see if the user is in the correct role to run the Meteor method. The ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/HACC-Hui/HACC-Hui/blob/master/app/imports/api/base/BaseCollection.js#L248"}),"BaseCollection")," implements this method only allowing ",Object(r.b)("inlineCode",{parentName:"p"},"Administrators")," to call the methods."))))}p.isMDXComponent=!0},131:function(e,t,o){"use strict";o.d(t,"a",(function(){return m})),o.d(t,"b",(function(){return h}));var a=o(0),n=o.n(a);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function c(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,a,n=function(e,t){if(null==e)return{};var o,a,n={},r=Object.keys(e);for(a=0;a<r.length;a++)o=r[a],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)o=r[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var l=n.a.createContext({}),p=function(e){var t=n.a.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):c(c({},t),e)),o},m=function(e){var t=p(e.components);return n.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},b=n.a.forwardRef((function(e,t){var o=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),m=p(o),b=a,h=m["".concat(i,".").concat(b)]||m[b]||d[b]||r;return o?n.a.createElement(h,c(c({ref:t},l),{},{components:o})):n.a.createElement(h,c({ref:t},l))}));function h(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=o.length,i=new Array(r);i[0]=b;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var l=2;l<r;l++)i[l]=o[l];return n.a.createElement.apply(null,i)}return n.a.createElement.apply(null,o)}b.displayName="MDXCreateElement"}}]);